{%for node in stellar.nodes%}

{% set module_name = 'stellar-core-{}-{}'.format(stellar.network_name, node.zone) %}

module "{{module_name}}" {
  source = "modules/stellar-core"

  access_key = "{{env_vars['AWS_ACCESS_KEY']}}"
  secret_key = "{{env_vars['AWS_SECRET_KEY']}}"
  key_name   = "{{env_vars['AWS_KEY_NAME']}}"

  stellar_network_name = "{{stellar.network_name}}"
  tld                  = "{{stellar.tld}}"
  zone                 = "{{node.zone}}"
  instance_type        = "{{stellar.instance_type}}"
}

output "route53-{{module_name}}" {
  description = "Route53 FQDN name assigned to the EC2 instance"
  value       = "${module.{{module_name}}.route53}"
}

output "instance_tags-{{module_name}}" {
  description = "List of tags"
  value       = "${module.{{module_name}}.instance_tags}"
}

output "s3-{{module_name}}" {
  description = "S3 bucket name"
  value       = "${module.{{module_name}}.s3}"
}

{%endfor%}


{#
# vi: ft=terraform.jinja2
#}
