daemon off;  # run in foreground, it runs in docker
pid /run/nginx.pid;

worker_processes auto;
events {
	worker_connections 768; #defualt
}

http {
	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	types_hash_max_size 2048;
	server_tokens off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	access_log /dev/stdout;
	error_log /dev/stderr;

        server{

          listen 80;
          listen 443 ssl;
	  proxy_read_timeout ${PROXY_READ_TIMEOUT};
          location / {
	    # If the request is for SSE, return 200 instead of 504
	    if ($http_accept = "text/event-stream"){
            error_page 504 = @sse_response;
	    }
            proxy_http_version 1.1;
            proxy_set_header Connection "";
            proxy_pass ${PROXY_PASS_URL};
          }

	  location @sse_response {
	    return 200;
	  }
}

}
